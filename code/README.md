### Note: it was decided to divide code for different modes into several files, respectively, for better readability
